<p id="notice"><%= notice %></p>

<p>
  <b>CAPA number:</b>
  <%= @capa.capa_number %>
</p>

<p>
  <b>Pump model:</b>
  <%= @capa.pump_model %>
</p>

<p>
  <b>Item number:</b>
  <%= @capa.item_number %>
</p>

<p>
  <b>Name:</b>
  <%= @capa.name %>
</p>

<p>
  <b>Date:</b>
  <%= @capa.date %>
</p>

<p>
  <b>Department:</b>
  <%= @capa.department %>
</p>

<p>
  <b>Description:</b>
  <%= @capa.description %>
</p>

<p>
  <b>Engineer:</b>
  <%= @capa.engineer %>
</p>

<p>
  <b>Quality comments:</b>
  <%= @capa.quality_comments %>
</p>

<p>
  <b>Ncr:</b>
  <%= @capa.ncr %>
</p>

<p>
  <b>Engr comments:</b>
  <%= @capa.engr_comments %>
</p>

<p>
  <b>Root:</b>
  <%= @capa.root %>
</p>

<p>
  <b>Cause:</b>
  <%= @capa.cause %>
</p>

<p>
  <b>Suggested:</b>
  <%= @capa.suggested %>
</p>

<p>
  <b>Solution:</b>
  <%= @capa.solution %>
</p>

<p>
  <b>Date assigned:</b>
  <%= @capa.date_assigned %>
</p>

<p>
  <b>Date resolved:</b>
  <%= @capa.date_resolved %>
</p>

<p>
  <b>Date closed:</b>
  <%= @capa.date_closed %>
</p>

<p>
  <b>Status:</b>
  <%= @capa.status %>
</p>

<p>
  <b>Follow up actions:</b>
  <%= @capa.follow_up_actions %>
</p>

<b>Uploaded Files:</b>
<table class="table">
<% @capa_files.each do |p| %>
  <tr>
  	<td><%= p.file_url.split("/").last unless p.file_url.nil? %></td>
    <td><%= button_to "Download File", {action: "download", controller: "capas", :file => p.file}  %></td>
    <% if user_in_admin? %>
	  <td><%= link_to "Delete File", p, method: :delete %></td>
	<% end %>
  </tr>
<% end %>
</table>

<% if user_in_quality? %>
  <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#assignModal">
  Assign CAPA
  </button>
  </br></br>
<% end %>
<% if @capa.status == "In Process" %>
  <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#resolveModal">
  Resolve CAPA
  </button>
  </br></br>
<% end %>

<%= link_to 'Edit', edit_capa_path(@capa) %> |
<%= link_to 'Back', capas_path %>



<!-- Assign Capa Modal -->
<div class="modal fade" style="display:none" id="assignModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
        <h4 class="modal-title" id="myModalLabel">Edit Email</h4>
      </div>
      <div class="modal-body">
        <%= render 'assign_email_fields' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></br>
        <%= button_to "Send", {action: "assign", :id => @capa.id}, {class: "btn btn-primary"}  %>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Resolve Capa Modal -->
<div class="modal fade" style="display:none" id="resolveModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">X</button>
        <h4 class="modal-title" id="myModalLabel">Edit Email</h4>
      </div>
      <div class="modal-body">
        <%= render 'resolve_email_fields' %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button></br>
        <%= button_to "Send", {action: "resolve", :id => @capa.id}, {class: "btn btn-primary"}  %>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->